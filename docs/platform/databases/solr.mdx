---
title: Solr
sidebar_position: 110
description: |
  Apache Solr is a powerful, open-source search platform built on Apache Lucene.
---

import PlanCompatibility from "@site/src/components/PlanCompatibility";

<PlanCompatibility plans={["ps", "ss"]} />

## What is Solr?

Apache Solr is a highly reliable, scalable and fault-tolerant search platform providing distributed indexing, replication, load-balanced querying, automated failover and recovery, centralized configuration, and more. Solr powers the search and navigation features of many of the world's largest internet sites, enabling powerful full-text search along with hit highlighting, faceted search, real-time indexing, dynamic clustering, database integration, and rich document handling.

Solr is built on Apache Lucene, a high-performance, full-featured text search engine library written in Java. Solr extends Lucene with HTTP APIs, making it easy to use from virtually any programming language. Solr's external configuration allows it to be tailored to many types of applications without Java coding, and it has a plugin architecture to support more advanced customization.

For content management systems like TYPO3, Solr provides powerful search capabilities that can significantly enhance the user experience by enabling fast and relevant search results across your website content.

## Creating a Solr database

You can provision a Solr search engine in your mittwald hosting environment using [containers](../../workloads/containers). There are several approaches to set up Solr:

### Using Terraform (Recommended)

The most convenient way to provision a Solr database is using [Terraform](/docs/v2/guides/deployment/terraform) with our [Solr module](https://registry.terraform.io/modules/mittwald/solr/mittwald/latest). The following example shows how you can use this module in your own Terraform deployment:

```hcl
module "solr" {
  source = "mittwald/solr/mittwald"

  project_id = var.project_id
  solr_version = "9"
  solr_core_name = "products"
  solr_heap = "2g"
}

output "solr_url" {
  value = module.solr.url
}
```

After this, you can access your Solr backend using the URL returned by the Terraform output. Usually, the URL should be `http://solr:8983`.

### Using the mStudio UI

Alternatively, you can set up a Solr container manually:

1. Go to **Containers** in your project in mStudio and create a new one. You can choose any name you like.

2. As image, enter either `solr:9` or `solr:9.9`, depending on how specific the version should be constrained. You can keep the entrypoint and command as suggested.

3. (optional) To automatically create a Solr core on container startup, change the command to `solr-precreate <corename>`, replacing `<corename>` with a name of your choice.

4. To make your Solr data persistent, create a volume under **Volumes** as follows:

   - Volume: Create new volume
   - Path in container (Mount Point): `/var/solr`

5. Set the following environment variables for the container:

   ```dotenv
   SOLR_HEAP=512m  # limits Solr RAM usage - important to prevent excessive memory consumption
   ```

The suggested port values are standard in the Solr context and can be accepted as is. The default port for Solr is 8983.

### Using the CLI with `mw container run`

You can also deploy a Solr container using the mittwald CLI with the `mw container run` command:

```bash
mw container run \
  --name solr \
  --env SOLR_HEAP=512m \
  --volume solr-data:/var/solr \
  --publish 8983:8983 \
  solr:9.9 solr-precreate typo3
```

This command creates a new container named "solr" using the Solr image, sets the necessary environment variables, and mounts a volume for persistent data storage.

### Using the CLI with `mw stack deploy`

If you prefer using Docker Compose, you can create a `docker-compose.yml` file and deploy it using the `mw stack deploy` command:

1. Create a `docker-compose.yml` file with the following content:

   ```yaml
   version: "3"
   services:
     solr:
       image: solr:9.9
       command: solr-precreate typo3
       environment:
         - SOLR_HEAP=512m
       ports:
         - "8983:8983"
       volumes:
         - solr-data:/var/solr
   volumes:
     solr-data:
   ```

2. Deploy the stack using the CLI:

   ```bash
   mw stack deploy
   ```

This approach is particularly useful when you need to deploy multiple containers that work together.

### Accessing your container within your hosting environment

Once the container is running, you can verify the instance is accessible by requesting it via `curl`:

```bash
curl -X GET "http://solr:8983/solr/admin/info/system"
```

You should receive a response with information about your Solr instance, including version, memory usage, and system properties.

## Creating a Solr Core

After setting up your Solr container, you'll need to create a core to store your search indices. You can do this using the Solr Admin UI or via the command line:

### Using the Solr Admin UI

1. Access the Solr Admin UI at `http://solr:8983/solr/`
2. Click on the "Core Admin" menu item
3. Click on "Add Core" and fill in the required fields:
   - name: The name of your core (e.g., "typo3")
   - instanceDir: Leave as default or specify a custom directory
   - dataDir: Leave as default or specify a custom directory
   - config: Leave as default (`solrconfig.xml`)
   - schema: Leave as default (`schema.xml`)

### Using the Command Line

You can also create a core using the Solr API via curl:

```bash
curl "http://solr:8983/solr/admin/cores?action=CREATE&name=typo3&configSet=_default"
```

## Operation

Solr runs as long as the container is running. When using Solr as a search engine for your CMS, the search indices need to be populated by your application. For this, most CMS platforms offer integrations.

The volume is automatically included in the regular backup of your project.

## Setting up Solr with TYPO3 CMS

TYPO3 CMS can be integrated with Solr using the extension `solr` (also known as EXT:solr). This section provides a step-by-step guide to configure TYPO3 with your Solr instance.

### Installing the Solr Extension

1. Install the Solr extension using Composer:

   ```bash
   composer require apache-solr-for-typo3/solr
   ```

   Or download it from the [TYPO3 Extension Repository](https://extensions.typo3.org/extension/solr) and install it through the Extension Manager.

2. After installation, go to the Extension Manager in the TYPO3 backend and activate the extension.

### Configuring the Solr Connection

1. Create or edit your site configuration in TYPO3 (Site Management > Sites).

2. In the site configuration, go to the "Solr" tab and configure the connection:

   - Host: `solr` (the hostname of your Solr container)
   - Port: `8983` (the default Solr port)
   - Path: `/solr/` (the default Solr path)
   - Core: `typo3` (or the name of the core you created)

3. Save the configuration.

### Configuring TypoScript

Add the following TypoScript setup to your root template:

```typoscript
plugin.tx_solr {
    solr {
        host = solr
        port = 8983
        path = /solr/
        scheme = http
        core = typo3
    }

    index {
        queue {
            pages {
                initialization = ApacheSolrForTypo3\Solr\IndexQueue\Initializer\Page
                indexer = ApacheSolrForTypo3\Solr\IndexQueue\PageIndexer
                indexer {
                    // add options here if needed
                }

                // Define which pages should be indexed
                additionalWhereClause = nav_hide = 0
            }

            // Add configuration for other content types as needed
        }
    }

    search {
        // Configure search settings
        targetPage = 123  // Replace with your search results page UID
    }
}
```

### Initializing the Index

After configuring the extension, you need to initialize the index:

1. Go to the TYPO3 backend and navigate to "Site Management > Solr".
2. Select the "Index Queue" tab.
3. Select the content types you want to index (e.g., pages).
4. Click on "Initialize selected content types".

Alternatively, you can use the TYPO3 console to initialize and index content:

```bash
# Initialize the index queue for pages
./vendor/bin/typo3 solr:updateconnections
./vendor/bin/typo3 solr:initializeindex pages

# Index all queued items
./vendor/bin/typo3 solr:indexqueue:indexall
```

### Adding a Search Form to Your Website

To add a search form to your website, you can use the provided Fluid templates or create your own:

1. Add a plugin content element to a page.
2. Select "Search: Form" as the plugin type.
3. Configure the plugin settings as needed.

For the search results, create a new page and add a "Search: Results" plugin to it. Make sure to set this page's UID as the `targetPage` in your TypoScript configuration.

### Advanced Configuration

For more advanced configuration options, refer to the [official EXT:solr documentation](https://docs.typo3.org/p/apache-solr-for-typo3/solr/main/en-us/).

## Troubleshooting

### Common Issues

1. **Connection Issues**: If TYPO3 cannot connect to Solr, verify that:

   - The Solr container is running
   - The hostname, port, and path are correctly configured
   - There are no network restrictions between your application and the Solr container

2. **Indexing Issues**: If content is not being indexed properly:

   - Check the TYPO3 system log for errors
   - Verify that the Solr core exists and is properly configured
   - Make sure the content you're trying to index meets the criteria defined in your TypoScript configuration

3. **Search Not Working**: If search functionality is not working as expected:
   - Verify that content has been indexed (check the Solr admin interface)
   - Ensure the search plugin is properly configured
   - Check that the search results page is correctly set up

### Solr Admin Interface

The Solr Admin Interface provides valuable tools for troubleshooting:

- **Core Admin**: Manage your Solr cores
- **Query**: Test search queries directly against your Solr index
- **Schema Browser**: Explore your schema configuration
- **Logging**: View Solr logs for error messages

Access the admin interface at `http://solr:8983/solr/`.
